{% extends 'admin_area/base.html' %}
{% block define %}
   {% if permission %}
   {% else %}
       <div class="col-md-12 col-lg-12" style="padding-right: 10%;padding-left: 10%">
        <h5 style="margin-left: 35%;color: red">您没有操作权限</h5>
      </div>
   {% endif %}
<script>
        $('#page_title').text('会员管理');
        $('#message_manage').addClass('active');
        $('#vip_manage').addClass('active')
</script>
<div class="col-lg-12 col-md-12" style="margin-bottom: 1%">
    <div class="col-md-5 col-lg-5 input-group has-success" style="width: 100%;max-width: 400px;margin-top: 1%;margin-left: 29%">
         <span class="input-group-addon">手机号:</span>
        <form action="vip_manage" method="post" id="p_mes">
            {% csrf_token %}
         <input id="phone" name="phone" type="text" class="form-control"
                onkeyup="this.value=this.value.replace(/\D/g,'')"
                 value="{{ phone }}" placeholder="若想单独查询，请在此输入要查询的手机号"/>
        </form>
    </div>
    <div class="col-md-1 col-lg-1" style="margin-top: -42px;margin-left: 58%">
         <button id="submit" class="btn btn-success">确定</button>
    </div>
    {% if phone %}
    <div class="col-md-1 col-lg-1" style="margin-top: -42px;margin-left: 65%">
         <a role="button" href="vip_manage" class="btn btn-success">显示所有</a>
    </div>
    {% endif %}
    <script>
        $('#submit').click(function(){
            if($('#phone').val().length == 11){
                $('#p_mes').submit()
            }
            else{
                alert('请填写正确的电话号码')
            }
        })
    </script>
</div>
<table class="table">
    <thead>
        {% if not phone %}
            共有 {{ count }} 个会员
        {% else %}
            {% if not vip_one %}
                没有符合条件的会员
            {% endif %}
        {% endif %}
    </thead>
    <tbody>
        <tr style="background-color: #1abc9c;color: #ffffff">
            <th>手机号</th>
            <th>性别</th>
            <th>地址</th>
            <th>邀请码</th>
            <th>注册时间</th>
            <th>生日</th>
        </tr>
        {% if vip_one %}
        <tr>
            <td>{{ vip_one.username }}</td>
            {% if vip_one.sex == 1 %}
                <td>男</td>
            {% elif vip_one.sex == 2 %}
                <td>女</td>
            {% else %}
                <td>保密</td>
            {% endif %}
            <td>{{ vip_one.address }}</td>
            <td>{{ vip_one.invite_code }}</td>
            <td>{{ vip_one.reg_time|date:"Y-m-d" }}</td>
            <td>
                {% if vip_one.birthday %}
                {{ vip_one.birthday|date:"Y-m-d" }}
                {% else %}
                    未填写
                {% endif %}
            </td>
        </tr>
        {% endif %}
        {% for vip in vips %}
        <tr>
            <td>{{ vip.username }}</td>
            {% if vip.sex == 1 %}
                <td>男</td>
            {% elif vip.sex == 2 %}
                <td>女</td>
            {% else %}
                <td>保密</td>
            {% endif %}
            <td>{{ vip.address }}</td>
            <td>{{ vip.invite_code }}</td>
            <td>{{ vip.reg_time|date:"Y-m-d" }}</td>
            <td>
                {% if vip.birthday %}
                {{ vip.birthday|date:"Y-m-d" }}
                {% else %}
                    未填写
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% if vips.has_previous or vips.has_next %}
    {% if vips.paginator.num_pages < 15 %}
  <div class="text-center">
      <div class="pagination pagination-success">
          <ul>
              {% if vips.has_previous %}
            <li><a href="vip_manage?page={{ vips.previous_page_number }}" class="btn btn-info previous">上一页</a></li>
             {% endif %}
             {% for page in vips.paginator.page_range %}
               {% if page == vips.number %}
            <li class="active"><a role="button" href="vip_manage?page={{ page }}">{{ page }}</a></li>
               {% else %}
            <li><a href="vip_manage?page={{ page }}">{{ page }}</a></li>
               {% endif %}
            {% endfor %}
            {% if vips.has_next %}
             <li><a href="vip_manage?page={{ vips.next_page_number }}" class="btn btn-info next">下一页</a></li>

            {% endif %}
          </ul>
      </div>
  </div>
  {% else %}
  <div class="text-center">
     {% if vips.has_previous %}
         <button class="btn btn-success" onclick="turn_page('{{ vips.previous_page_number }}')">上一页</button>
     {% else %}
         <button class="btn btn-success" disabled="disabled">上一页</button>
     {% endif %}
     <select id="select3" class="form-control select select-success select-block mbl" onchange="turn_page(this.value)">
         {% for page in vips.paginator.page_range %}
             {% if page == vips.number %}
             <option value="{{ page }}" selected>第{{ page }}页</option>
             {% else %}
             <option value="{{ page }}">第{{ page }}页</option>
             {% endif %}
         {% endfor %}
     </select>
     <script>
         $("#select3").select2({dropdownCssClass: 'dropdown-inverse'});
     </script>
     {% if vips.has_next %}
         <button class="btn btn-success" onclick="turn_page('{{ vips.next_page_number }}')">下一页</button>
     {% else %}
         <button class="btn btn-success" disabled="disabled">下一页</button>
     {% endif %}
  </div>
  <script>
   function turn_page(page_num){
       window.location.href = "vip_manage?page=" + page_num;
   }
  </script>
  {% endif %}
{% endif %}
{% endblock %}